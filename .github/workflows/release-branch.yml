name: Release Branch

on:
  push:
    branches:
      - develop

  workflow_dispatch:

jobs:
    release-branch:
      #uses: dolorestec/devops/.github/workflows/release-branch.yml@v1 
      name: Variables
      runs-on: ubuntu-latest
      steps:
        - name: Checkout
          uses: actions/checkout@v2
          with:
            repository: ${{ github.repository }}
            ref: ${{ github.ref_name }}
            fetch-depth: 0

        - name: Setting variables
          env:
            DLRS_NAME: ${{ github.repository }}
            DLRS_BRANCH: ${{ github.ref_name }}
            DLRS_VERSION: $(git tag --sort creatordate -l "v*-RELEASE*" --merged)
            DLRS_VARIABLES: ${{ toJson(env) }}
          run: |
            echo $DLRS_VARIABLES

        - name: For nas variaveis
          run: |
            for var in $DLRS_VARIABLES; do
              echo $var
            done

        - name: Print variables
          run: |
            echo $DLRS_NAME
            echo $DLRS_BRANCH
            echo $DLRS_VERSION

        - name: To file
          run: |
            ${{ toJson(env) }} > variables.json

        - name: Upload variables
          run: |
            cat variables.json

    finish:
        name: Finish
        needs: release-branch
        runs-on: ubuntu-latest

        steps:
          - name: Print variables
            run: |
              echo $DLRS_NAME
              echo $DLRS_BRANCH
              echo $DLRS_VERSION